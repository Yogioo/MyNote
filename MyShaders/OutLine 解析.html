<html>
<head>
  <title>OutLine 解析</title>
  <basefont face="Segoe UI" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (en-US, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Segoe UI;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="671"/>
<h1>OutLine 解析</h1>

<div>
<span><div><font style="font-size: 16pt;"><img src="OutLine 解析_files/Image.png" type="image/png" data-filename="Image.png"/></font></div><div><font style="font-size: 16pt;">总结:</font></div><div><font style="font-size: 16pt;">    渲染两次 通过Pass 实现, 通过深度测试 来置顶想要显示的物体</font></div><div><font style="font-size: 16pt;">    通过v(世界坐标点)乘浮点数来控制定点的位置来实现整体模型的显示放大缩小</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">更好的写法:</font></div><div><font style="font-size: 16pt;">    因为上面的写法因为Ztest的问题会导致持续存在在上面 会覆盖掉很多不应该被覆盖的东西</font></div><div><font style="font-size: 16pt;">    下面的方法把外边框显示的pass 的cull 改成了不显示前面 就能实现更好地效果</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 16pt;">Shader &quot;Custom/OutLine2&quot;</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">    Properties</font></div><div><font style="font-size: 16pt;">    {</font></div><div><font style="font-size: 16pt;">        _MainTex (&quot;Texture&quot;, 2D) = &quot;white&quot; {}</font></div><div><font style="font-size: 16pt;">        _OutLineSize(&quot;外边框大小&quot;,float) = 0.02</font></div><div><font style="font-size: 16pt;">        _Color(&quot;外边框颜色&quot;,Color) = (1,1,0,1)</font></div><div><font style="font-size: 16pt;">    }</font></div><div><font style="font-size: 16pt;">    SubShader</font></div><div><font style="font-size: 16pt;">    {</font></div><div><span style="color: rgb(51, 51, 51); font-family: Monaco;"><font style="font-size: 16pt;"><br/></font></span></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">        Pass</font></div><div><font style="font-size: 16pt;">        {</font></div><div><font style="font-size: 16pt;">            Cull Front // 不显示面向摄像机的面 显示背向摄像机的面</font></div><div><font style="font-size: 16pt;">            CGPROGRAM</font></div><div><font style="font-size: 16pt;">            #pragma vertex vert</font></div><div><font style="font-size: 16pt;">            #pragma fragment frag</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            #include &quot;UnityCG.cginc&quot;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            struct appdata</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                float4 vertex : POSITION;</font></div><div><font style="font-size: 16pt;">                float2 uv : TEXCOORD0;</font></div><div><font style="font-size: 16pt;">                fixed3 normal: NORMAL;</font></div><div><font style="font-size: 16pt;">            };</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            struct v2f</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                float2 uv : TEXCOORD0;</font></div><div><font style="font-size: 16pt;">                float4 vertex : SV_POSITION;</font></div><div><font style="font-size: 16pt;">            };</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            fixed _OutLineSize;</font></div><div><font style="font-size: 16pt;">            v2f vert (appdata v)</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                v2f o;</font></div><div><font style="font-size: 16pt;">                v.vertex.xyz += v.normal * _OutLineSize;</font></div><div><font style="font-size: 16pt;">                o.vertex = UnityObjectToClipPos(v.vertex);</font></div><div><font style="font-size: 16pt;">                o.uv = v.uv;</font></div><div><font style="font-size: 16pt;">                return o;</font></div><div><font style="font-size: 16pt;">            }</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            sampler2D _MainTex;</font></div><div><font style="font-size: 16pt;">            fixed4 _Color;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            fixed4 frag (v2f i) : SV_Target</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                fixed4 col = tex2D(_MainTex, i.uv) * _Color;</font></div><div><font style="font-size: 16pt;">                return col;</font></div><div><font style="font-size: 16pt;">            }</font></div><div><font style="font-size: 16pt;">            ENDCG</font></div><div><font style="font-size: 16pt;">        }</font></div><div><font style="font-size: 16pt;">        </font></div><div><font style="font-size: 16pt;">        </font></div><div><font style="font-size: 16pt;">        Pass</font></div><div><font style="font-size: 16pt;">        {</font></div><div><font style="font-size: 16pt;">            CGPROGRAM</font></div><div><font style="font-size: 16pt;">            #pragma vertex vert</font></div><div><font style="font-size: 16pt;">            #pragma fragment frag</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            #include &quot;UnityCG.cginc&quot;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            struct appdata</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                float4 vertex : POSITION;</font></div><div><font style="font-size: 16pt;">                float2 uv : TEXCOORD0;</font></div><div><font style="font-size: 16pt;">                fixed3 normal: NORMAL;</font></div><div><font style="font-size: 16pt;">            };</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            struct v2f</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                float2 uv : TEXCOORD0;</font></div><div><font style="font-size: 16pt;">                float4 vertex : SV_POSITION;</font></div><div><font style="font-size: 16pt;">            };</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            fixed _OutLineSize;</font></div><div><font style="font-size: 16pt;">            v2f vert (appdata v)</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                v2f o;</font></div><div><font style="font-size: 16pt;">                o.vertex = UnityObjectToClipPos(v.vertex);</font></div><div><font style="font-size: 16pt;">                o.uv = v.uv;</font></div><div><font style="font-size: 16pt;">                return o;</font></div><div><font style="font-size: 16pt;">            }</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            sampler2D _MainTex;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            fixed4 frag (v2f i) : SV_Target</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                fixed4 col = tex2D(_MainTex, i.uv);</font></div><div><font style="font-size: 16pt;">                return col;</font></div><div><font style="font-size: 16pt;">            }</font></div><div><font style="font-size: 16pt;">            ENDCG</font></div><div><font style="font-size: 16pt;">        }</font></div><div><font style="font-size: 16pt;">    }</font></div><div><font style="font-size: 16pt;">}</font></div></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">二次改进: 加入了hdr颜色的发光</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 16pt;">Shader &quot;Unlit/CustomEmission&quot;</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">    Properties</font></div><div><font style="font-size: 16pt;">    {</font></div><div><font style="font-size: 16pt;">        _MainTex (&quot;Texture&quot;, 2D) = &quot;white&quot; {}</font></div><div><font style="font-size: 16pt;">        _MainColor(&quot;Color&quot;,Color) = (1,1,1,1)</font></div><div><font style="font-size: 16pt;">        _Light(&quot;LightDistence&quot;,float) = 0.1</font></div><div><font style="font-size: 16pt;">        </font></div><div><font style="font-size: 16pt;">        [HDR]_Emission(&quot;Emission&quot;,Color) = (1,0,1,1)</font></div><div><font style="font-size: 16pt;">        </font></div><div><font style="font-size: 16pt;">    }</font></div><div><font style="font-size: 16pt;">    SubShader</font></div><div><font style="font-size: 16pt;">    {</font></div><div><font style="font-size: 16pt;">        Tags { &quot;RenderType&quot;=&quot;Opaque&quot; }</font></div><div><font style="font-size: 16pt;">        LOD 100</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">        Pass</font></div><div><font style="font-size: 16pt;">        {</font></div><div><font style="font-size: 16pt;">            cull front</font></div><div><font style="font-size: 16pt;">            CGPROGRAM</font></div><div><font style="font-size: 16pt;">            #pragma vertex vert</font></div><div><font style="font-size: 16pt;">            #pragma fragment frag</font></div><div><font style="font-size: 16pt;">            #pragma multi_compile_fog</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            #include &quot;UnityCG.cginc&quot;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            struct appdata</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                float4 vertex : POSITION;</font></div><div><font style="font-size: 16pt;">                float2 uv : TEXCOORD0;</font></div><div><font style="font-size: 16pt;">                fixed4 normal:NORMAL;</font></div><div><font style="font-size: 16pt;">            };</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            struct v2f</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                float2 uv : TEXCOORD0;</font></div><div><font style="font-size: 16pt;">                UNITY_FOG_COORDS(1)</font></div><div><font style="font-size: 16pt;">                float4 vertex : SV_POSITION;</font></div><div><font style="font-size: 16pt;">            };</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            sampler2D _MainTex;</font></div><div><font style="font-size: 16pt;">            float4 _MainTex_ST;</font></div><div><font style="font-size: 16pt;">            float _Light;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            v2f vert (appdata v)</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                v2f o;</font></div><div><font style="font-size: 16pt;">                v.vertex += v.normal * _Light;</font></div><div><font style="font-size: 16pt;">                </font></div><div><font style="font-size: 16pt;">                o.vertex = UnityObjectToClipPos(v.vertex);</font></div><div><font style="font-size: 16pt;">                </font></div><div><font style="font-size: 16pt;">                </font></div><div><font style="font-size: 16pt;">                o.uv = TRANSFORM_TEX(v.uv, _MainTex);</font></div><div><font style="font-size: 16pt;">                UNITY_TRANSFER_FOG(o,o.vertex);</font></div><div><font style="font-size: 16pt;">                return o;</font></div><div><font style="font-size: 16pt;">            }</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            fixed4 _Emission;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            fixed4 frag (v2f i) : SV_Target</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                fixed4 col = tex2D(_MainTex, i.uv);</font></div><div><font style="font-size: 16pt;">                col *= _Emission;</font></div><div><font style="font-size: 16pt;">                UNITY_APPLY_FOG(i.fogCoord, col);</font></div><div><font style="font-size: 16pt;">                return col;</font></div><div><font style="font-size: 16pt;">            }</font></div><div><font style="font-size: 16pt;">            ENDCG</font></div><div><font style="font-size: 16pt;">        }     </font></div><div><font style="font-size: 16pt;">        </font></div><div><font style="font-size: 16pt;">        </font></div><div><font style="font-size: 16pt;">        Pass</font></div><div><font style="font-size: 16pt;">        {</font></div><div><font style="font-size: 16pt;">            CGPROGRAM</font></div><div><font style="font-size: 16pt;">            #pragma vertex vert</font></div><div><font style="font-size: 16pt;">            #pragma fragment frag</font></div><div><font style="font-size: 16pt;">            #pragma multi_compile_fog</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            #include &quot;UnityCG.cginc&quot;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            struct appdata</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                float4 vertex : POSITION;</font></div><div><font style="font-size: 16pt;">                float2 uv : TEXCOORD0;</font></div><div><font style="font-size: 16pt;">                fixed4 normal:NORMAL;</font></div><div><font style="font-size: 16pt;">            };</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            struct v2f</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                float2 uv : TEXCOORD0;</font></div><div><font style="font-size: 16pt;">                UNITY_FOG_COORDS(1)</font></div><div><font style="font-size: 16pt;">                float4 vertex : SV_POSITION;</font></div><div><font style="font-size: 16pt;">            };</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            sampler2D _MainTex;</font></div><div><font style="font-size: 16pt;">            float4 _MainTex_ST;</font></div><div><font style="font-size: 16pt;">            float _Light;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            v2f vert (appdata v)</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                v2f o;</font></div><div><font style="font-size: 16pt;">                o.vertex = UnityObjectToClipPos(v.vertex);</font></div><div><font style="font-size: 16pt;">                o.uv = TRANSFORM_TEX(v.uv, _MainTex);</font></div><div><font style="font-size: 16pt;">                UNITY_TRANSFER_FOG(o,o.vertex);</font></div><div><font style="font-size: 16pt;">                return o;</font></div><div><font style="font-size: 16pt;">            }</font></div><div><font style="font-size: 16pt;">            </font></div><div><font style="font-size: 16pt;">            fixed4 _MainColor;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">            fixed4 frag (v2f i) : SV_Target</font></div><div><font style="font-size: 16pt;">            {</font></div><div><font style="font-size: 16pt;">                fixed4 col = tex2D(_MainTex, i.uv);</font></div><div><font style="font-size: 16pt;">                col *= _MainColor;</font></div><div><font style="font-size: 16pt;">                UNITY_APPLY_FOG(i.fogCoord, col);</font></div><div><font style="font-size: 16pt;">                return col;</font></div><div><font style="font-size: 16pt;">            }</font></div><div><font style="font-size: 16pt;">            ENDCG</font></div><div><font style="font-size: 16pt;">        }</font></div><div><font style="font-size: 16pt;">        </font></div><div><font style="font-size: 16pt;">        </font></div><div><font style="font-size: 16pt;">        </font></div><div><font style="font-size: 16pt;">    }</font></div><div><font style="font-size: 16pt;">}</font></div></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 16pt;">Shader &quot;U3DC/OutLightting&quot;</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">Properties</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">_MainTex(&quot;Texture (RGB)&quot;, 2D) = &quot;black&quot; {}</font></div><div><font style="font-size: 16pt;">_Color(&quot;Color&quot;, Color) = (0, 0, 0, 1)</font></div><div><font style="font-size: 16pt;">_AtmoColor(&quot;Atmosphere Color&quot;, Color) = (0.5, 0.5, 1.0, 1)</font></div><div><font style="font-size: 16pt;">_Size(&quot;Size&quot;, Float) = 0.1</font></div><div><font style="font-size: 16pt;">_Falloff(&quot;Falloff&quot;, Float) = 5</font></div><div><font style="font-size: 16pt;">_FalloffPlanet(&quot;Falloff Planet&quot;, Float) = 5</font></div><div><font style="font-size: 16pt;">_Transparency(&quot;Transparency&quot;, Float) = 15</font></div><div><font style="font-size: 16pt;">_TransparencyPlanet(&quot;Transparency Planet&quot;, Float) = 1</font></div><div><font style="font-size: 16pt;">}</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">SubShader</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">Pass</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">Name &quot;PlanetBase&quot;</font></div><div><font style="font-size: 16pt;">Tags {&quot;LightMode&quot; = &quot;Always&quot;}</font></div><div><font style="font-size: 16pt;">Cull Back</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">CGPROGRAM</font></div><div><font style="font-size: 16pt;">#pragma vertex vert</font></div><div><font style="font-size: 16pt;">#pragma fragment frag</font></div><div><font style="font-size: 16pt;">#pragma fragmentoption ARB_fog_exp2</font></div><div><font style="font-size: 16pt;">#pragma fragmentoption ARB_precision_hint_fastest</font></div><div><font style="font-size: 16pt;">#include &quot;UnityCG.cginc&quot;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">uniform sampler2D _MainTex;</font></div><div><font style="font-size: 16pt;">uniform float4 _MainTex_ST;</font></div><div><font style="font-size: 16pt;">uniform float4 _Color;</font></div><div><font style="font-size: 16pt;">uniform float4 _AtmoColor;</font></div><div><font style="font-size: 16pt;">uniform float _FalloffPlanet;</font></div><div><font style="font-size: 16pt;">uniform float _TransparencyPlanet;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">struct v2f</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">float4 pos : SV_POSITION;</font></div><div><font style="font-size: 16pt;">float3 normal : TEXCOORD0;</font></div><div><font style="font-size: 16pt;">float3 worldvertpos : TEXCOORD1;</font></div><div><font style="font-size: 16pt;">float2 texcoord : TEXCOORD2;</font></div><div><font style="font-size: 16pt;">};</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">v2f vert(appdata_base v)</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">v2f o;</font></div><div><font style="font-size: 16pt;">o.pos = mul (UNITY_MATRIX_MVP, v.vertex);</font></div><div><font style="font-size: 16pt;">o.normal = v.normal;</font></div><div><font style="font-size: 16pt;">o.worldvertpos = mul(_Object2World, v.vertex).xyz;</font></div><div><font style="font-size: 16pt;">o.texcoord = TRANSFORM_TEX(v.texcoord, _MainTex);</font></div><div><font style="font-size: 16pt;">return o;</font></div><div><font style="font-size: 16pt;">}</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">float4 frag(v2f i) : COLOR</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">i.normal = normalize(i.normal);</font></div><div><font style="font-size: 16pt;">float3 viewdir = normalize(_WorldSpaceCameraPos-i.worldvertpos);</font></div><div><font style="font-size: 16pt;">float4 atmo = _AtmoColor;</font></div><div><font style="font-size: 16pt;">atmo.a = pow(1.0-saturate(dot(viewdir, i.normal)), _FalloffPlanet);</font></div><div><font style="font-size: 16pt;">atmo.a *= _TransparencyPlanet*_Color;</font></div><div><font style="font-size: 16pt;">float4 color = tex2D(_MainTex, i.texcoord)*_Color;</font></div><div><font style="font-size: 16pt;">color.rgb = lerp(color.rgb, atmo.rgb, atmo.a);</font></div><div><font style="font-size: 16pt;">return color*dot(normalize(i.worldvertpos-_WorldSpaceLightPos0), i.normal);</font></div><div><font style="font-size: 16pt;">}</font></div><div><font style="font-size: 16pt;">ENDCG</font></div><div><font style="font-size: 16pt;">}</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">Pass</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">Name &quot;AtmosphereBase&quot;</font></div><div><font style="font-size: 16pt;">Tags {&quot;LightMode&quot; = &quot;Always&quot;}</font></div><div><font style="font-size: 16pt;">Cull Front</font></div><div><font style="font-size: 16pt;">Blend SrcAlpha One</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">CGPROGRAM</font></div><div><font style="font-size: 16pt;">#pragma vertex vert</font></div><div><font style="font-size: 16pt;">#pragma fragment frag</font></div><div><font style="font-size: 16pt;">#pragma fragmentoption ARB_fog_exp2</font></div><div><font style="font-size: 16pt;">#pragma fragmentoption ARB_precision_hint_fastest</font></div><div><font style="font-size: 16pt;">#include &quot;UnityCG.cginc&quot;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">uniform float4 _Color;</font></div><div><font style="font-size: 16pt;">uniform float4 _AtmoColor;</font></div><div><font style="font-size: 16pt;">uniform float _Size;</font></div><div><font style="font-size: 16pt;">uniform float _Falloff;</font></div><div><font style="font-size: 16pt;">uniform float _Transparency;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">struct v2f</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">float4 pos : SV_POSITION;</font></div><div><font style="font-size: 16pt;">float3 normal : TEXCOORD0;</font></div><div><font style="font-size: 16pt;">float3 worldvertpos : TEXCOORD1;</font></div><div><font style="font-size: 16pt;">};</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">v2f vert(appdata_base v)</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">v2f o;</font></div><div><font style="font-size: 16pt;">v.vertex.xyz += v.normal*_Size;</font></div><div><font style="font-size: 16pt;">o.pos = mul (UNITY_MATRIX_MVP, v.vertex);</font></div><div><font style="font-size: 16pt;">o.normal = v.normal;</font></div><div><font style="font-size: 16pt;">o.worldvertpos = mul(_Object2World, v.vertex);</font></div><div><font style="font-size: 16pt;">return o;</font></div><div><font style="font-size: 16pt;">}</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">float4 frag(v2f i) : COLOR</font></div><div><font style="font-size: 16pt;">{</font></div><div><font style="font-size: 16pt;">i.normal = normalize(i.normal);</font></div><div><font style="font-size: 16pt;">float3 viewdir = normalize(i.worldvertpos-_WorldSpaceCameraPos);</font></div><div><font style="font-size: 16pt;">float4 color = _AtmoColor;</font></div><div><font style="font-size: 16pt;">color.a = pow(saturate(dot(viewdir, i.normal)), _Falloff);</font></div><div><font style="font-size: 16pt;">color.a *= _Transparency*_Color*dot(normalize(i.worldvertpos- _WorldSpaceLightPos0), i.normal);</font></div><div><font style="font-size: 16pt;">return color;</font></div><div><font style="font-size: 16pt;">}</font></div><div><font style="font-size: 16pt;">ENDCG</font></div><div><font style="font-size: 16pt;">}</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">}</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">FallBack &quot;Diffuse&quot;</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">}</font></div></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">以上的方法并不能实现非常好的效果.</font></div><div><font style="font-size: 16pt;">1.顶点的扩大方式应该是向法线的方向前进一定的倍距.</font></div><div><font style="font-size: 16pt;">2.为了不让外框线变成近大远小 所以需要在从顶点转到世界坐标后再位移</font></div><div><font style="font-size: 16pt;">3.</font></div><div><font color="#383A42" face="Source Code Pro" style="font-size: 16pt;">分析代码:</font></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><span>    首先把顶点坐标转换成世界坐标</span></span></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><span><span>    把发现从模型坐标转换成世界坐标</span><br/></span></span></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><span><span>    </span>接着把法线投影成为摄像机坐标系中的一个二维向量</span><br/></span></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><span><span>    把世界坐标系中的顶点坐标 加上 偏移 </span><br/></span></span></div><div><font color="#383A42" face="Source Code Pro"><span style="font-size: 21.3333px;">然后就能实现近距离 远距离 外框线的大小一致</span></font></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><br/></span></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;">Cull Front //这个是放在Pass中 剔除正面 用于把面向摄像机的那个面去除的</span></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><br/></span></div><div><font color="#383A42" face="Source Code Pro" style="font-size: 16pt;">o.pos = mul(UNITY_MATRIX_MVP,v.vertex);</font></div><div><font color="#383A42" face="Source Code Pro" style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><span style="color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">float3 vWorldNormal = mul((float3x3)UNITY_MATRIX_IT_MV, v.normal);</span> </font></div><div><font style="font-size: 16pt;"><span style="color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);"><br/></span></font></div><div><font style="font-size: 16pt;"><span style="color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">float2 offset = TransformViewToProjection(vnormal.xy);</span></font></div><div><font style="font-size: 16pt;"><span style="color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);"><br/></span></font></div><div><span style="color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><font style="font-size: 16pt;">o.pos.xy = offset * _OutLineFactor;        //OutLineFactor self define</font></span></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><br/></span></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;">return o;</span></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><br/></span></div><div><font color="#383A42" face="Source Code Pro"><span style="font-size: 21.3333px;">分析UNITY_MATRIX_IT_MV 矩阵 将法线转换到视空间 因为如果模型被非等比例缩放的时候会出现法线的变换</span></font></div><div><font color="#383A42" face="Source Code Pro"><span style="font-size: 21.3333px;">为了保证一致性,所以采用了这种方法实现这样的功能</span></font></div><div><font color="#383A42" face="Source Code Pro"><span style="font-size: 21.3333px;"><br/></span></font></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><img src="OutLine 解析_files/Image [1].png" type="image/png" data-filename="Image.png"/></span></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><br/></span></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><img src="OutLine 解析_files/Image [2].png" type="image/png" data-filename="Image.png"/></span></div><div><font color="#383A42" face="Source Code Pro"><span style="font-size: 21.3333px;">他说的我没看懂 不过显示效果的bug我倒是理解了,所以我会在pass中加入一个命令</span></font></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;">Offset 1,1</span></div><div><font color="#383A42" face="Source Code Pro"><span style="font-size: 21.3333px;">这个命令能使得描边的通道远离摄像机一点,防止了与正常的pass重叠穿插 (Stiching)</span></font></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><br/></span></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;">slope 和 Units 分别指前一个和后一个</span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Offset = slope * Factor + r * Units</span></div><div><span style="font-size: 16pt; color: rgb(56, 58, 66); font-family: &quot;Source Code Pro&quot;;"><br/></span></div><div><span style="font-weight: bold; box-sizing: border-box; outline: 0px; overflow-wrap: break-word; color: rgb(255, 0, 0); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Offset大于0，Pass对应的模型离摄像机更远；Offset小于0，Pass对应的模型离摄像机更近</span></div><div><br/></div><div><img src="OutLine 解析_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div><br/></div></span>
</div></body></html> 