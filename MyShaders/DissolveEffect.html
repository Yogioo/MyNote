<html>
<head>
  <title>DissolveEffect</title>
  <basefont face="Segoe UI" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (en-US, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Segoe UI;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1372"/>
<h1>DissolveEffect</h1>

<div>
<span><div><span style="font-size: 16pt;">溶解效果</span></div><div><font style="font-size: 16pt;"><br/></font></div><div><span style="font-size: 16pt;"><img src="DissolveEffect_files/TempGIF.gif" type="image/gif" data-filename="TempGIF.gif"/></span></div><div><span style="font-size: 16pt;">噪音贴图切的小了一点,效果如下:</span></div><div><span style="font-size: 16pt;"><img src="DissolveEffect_files/TempGIF2.gif" type="image/gif" data-filename="TempGIF2.gif"/></span></div><div><font style="font-size: 16pt;"><br/></font></div><div><span style="font-size: 21.3333px;">Shader代码:</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Shader &quot;Custom/DissolveEffect&quot;</div><div>{</div><div>    Properties</div><div>    {</div><div>        _MainTex (&quot;Texture&quot;, 2D) = &quot;white&quot; {}</div><div>        _Diffuse(&quot;Diffuse&quot;,Color) = (1,1,1,1)</div><div>        _DissolveColorA(&quot;Dissolve Color A&quot;,Color) = (1,0,0,1)</div><div>        _DissolveColorB(&quot;Dissolve Color B&quot;,Color) = (0,1,0,1)</div><div>        _DissolveMap(&quot;DissolveMap&quot;,2D)= &quot;white&quot;{}</div><div>        _DissolveThreshold(&quot;DissolveThreshold&quot;,Range(0,1)) = 0</div><div>        _ColorFactorA(&quot;ColorFactorA&quot;,Range(0,1)) = 0.7</div><div>        _ColorFactorB(&quot;ColorFactorB&quot;,Range(0,1)) = 0.8</div><div><br/></div><div><br/></div><div>        _AnimatiomTime(&quot;AnimationTime&quot;,Range(0,1)) = .5</div><div><br/></div><div><br/></div><div>    }</div><div>    SubShader</div><div>    {</div><div>        Tags { &quot;RenderType&quot;=&quot;Opaque&quot; }</div><div>        LOD 100</div><div><br/></div><div><br/></div><div>        Pass</div><div>        {</div><div>            CGPROGRAM</div><div>            #pragma vertex vert</div><div>            #pragma fragment frag</div><div><br/></div><div><br/></div><div>            #include &quot;UnityCG.cginc&quot;</div><div>            #include &quot;Lighting.cginc&quot;</div><div><br/></div><div><br/></div><div>            sampler2D _MainTex;</div><div>            float4 _MainTex_ST;</div><div>            fixed4 _Diffuse;</div><div>            sampler2D _DissolveMap;</div><div>            float _DissolveThreshold;</div><div>            float _ColorFactorA;</div><div>            float _ColorFactorB;</div><div>            fixed4 _DissolveColorA;</div><div>            fixed4 _DissolveColorB;</div><div>            float _AnimatiomTime;</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>            struct v2f</div><div>            {</div><div>                float2 uv : TEXCOORD1;</div><div>                float4 vertex : SV_POSITION;</div><div>                float3 worldNormal:TEXCOORD0;</div><div>            };</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>            v2f vert (appdata_base v)</div><div>            {</div><div>                v2f o;</div><div><br/></div><div><br/></div><div>                if(_DissolveThreshold &gt; _AnimatiomTime){</div><div>                    v.vertex.xyz += v.normal * saturate(_DissolveThreshold - _AnimatiomTime) * _AnimatiomTime;</div><div>                }</div><div><br/></div><div><br/></div><div>                o.vertex = UnityObjectToClipPos(v.vertex);</div><div><br/></div><div><br/></div><div>                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</div><div>                o.worldNormal = mul(v.normal, (float3x3)unity_WorldToObject);</div><div><br/></div><div><br/></div><div>                return o;</div><div>            }</div><div><br/></div><div><br/></div><div>            fixed4 frag (v2f i) : SV_Target</div><div>            {</div><div>                fixed4 dissolveValue = tex2D(_DissolveMap,i.uv);</div><div><br/></div><div><br/></div><div>                if(dissolveValue.r &lt; _DissolveThreshold){</div><div>                    discard;</div><div>                }</div><div><br/></div><div><br/></div><div>                fixed3 worldNormal = normalize(i.worldNormal);</div><div>                fixed3 worldLightDir = normalize(_WorldSpaceLightPos0.xyz);</div><div>                fixed3 lambert = saturate(dot(worldNormal,worldLightDir));</div><div>                fixed3 albedo = lambert * _Diffuse.xyz * _LightColor0.xyz + UNITY_LIGHTMODEL_AMBIENT.xyz;</div><div>                fixed3 col = tex2D(_MainTex, i.uv).rgb * albedo;</div><div><br/></div><div><br/></div><div>                float lerpValue = _DissolveThreshold / dissolveValue.r;</div><div><br/></div><div><br/></div><div>                if(lerpValue &gt; _ColorFactorA){</div><div>                    if(lerpValue &gt; _ColorFactorB){</div><div>                        return _DissolveColorB;</div><div>                    }</div><div>                    return _DissolveColorA;</div><div>                }</div><div><br/></div><div><br/></div><div>                return fixed4(col,1);</div><div>            }</div><div>            ENDCG</div><div>        }</div><div>    }</div><div>}</div><div><br/></div><div><br/></div></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;"><span>    </span><span>    </span>//优化版本，尽量不在shader中用分支判断的版本,但是代码很难理解啊....</span></div><div><span style="font-size: 16pt;">        float percentage = _DissolveThreshold / dissolveValue.r;</span></div><div><span style="font-size: 16pt;">        //如果当前百分比 - 颜色权重 - 边缘颜色</span></div><div><span style="font-size: 16pt;">        float lerpEdge = sign(percentage - _ColorFactor - _DissolveEdge);</span></div><div><span style="font-size: 16pt;">        //貌似sign返回的值还得saturate一下，否则是一个很奇怪的值</span></div><div><span style="font-size: 16pt;">        fixed3 edgeColor = lerp(_DissolveEdgeColor.rgb, _DissolveColor.rgb, saturate(lerpEdge));</span></div><div><span style="font-size: 16pt;">        //最终输出颜色的lerp值</span></div><div><span style="font-size: 16pt;">        float lerpOut = sign(percentage - _ColorFactor);</span></div><div><span style="font-size: 16pt;">        //最终颜色在原颜色和上一步计算的颜色之间差值（其实经过saturate（sign（..））的lerpOut应该只能是0或1）</span></div><div><span style="font-size: 16pt;">        fixed3 colorOut = lerp(color, edgeColor, saturate(lerpOut));</span></div><div><span style="font-size: 16pt;">        return fixed4(colorOut, 1);</span></div><div><span style="font-size: 16pt;"><br/></span></div><div><span style="font-size: 16pt;">详细信息:</span><a href="https://blog.csdn.net/puppet_master/article/details/72455945" style="font-size: 16pt;">https://blog.csdn.net/puppet_master/article/details/72455945</a></div></span>
</div></body></html> 